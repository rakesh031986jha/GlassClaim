!function(a,b){"use strict";a.pru=b.extend(a.pru||{},{wcf:{currentDdo:"",localDataMap:[],keyNamesBag:[]}});var c={SENSITIVE:1,INSENSITIVE:2,NONE:3,properties:{prop1:{name:"SENSITIVE",value:1,code:"S"},prop2:{name:"INSENSITIVE",value:2,code:"I"},prop3:{name:"NONE",value:3,code:"NA"}}},d={SET_ATTRIBUTES:"SaveData",GET_ATTRIBUTES:"GetData",REMOVE_ATTRIBUTES:"RemoveKeys",REMOVE_ALL_ATTRIBUTES:"ClearData",GET_ALL_ATTRIBUTES:"GetAllKeys",properties:{prop1:{name:"SET_ATTRIBUTES",value:"SaveData",code:"1"},prop2:{name:"GET_ATTRIBUTES",value:"GetData",code:"2"},prop3:{name:"REMOVE_ATTRIBUTES",value:"RemoveKeys",code:"3"},prop4:{name:"REMOVE_ALL_ATTRIBUTES",value:"ClearData",code:"4"},prop5:{name:"GET_ALL_ATTRIBUTES",value:"GetAllKeys",code:"5"}}},e=b.module("pru.com.client.wcf",["ngCookies"]);e.run(["$$DSM",function(a){a.initialize()}]),e.value("$$Utils",{CHECK_IS_EMPTY:function(a){var b=Object.prototype.hasOwnProperty;if(null===a||void 0===a||""===a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;if("object"!=typeof a)return!0;for(var c in a)if(b.call(a,c))return!1;return!0}}),e.service("$$Analytics",function(){this.saveAnalyticInfo=function(a,b){return b&&console.log("WCF $$Analytics Message: "+b+a),0}}),e.provider("$$Logger",function(){var a=10;this.setPushCount=function(b){a=b},this.$get=function(){function a(a){i=a,$(i).html("")}function b(a,b){g.push({logType:a,message:b}),$(i).append("<li>"+a+" - "+b+"</li>"),g.length>h||"error"===a}function c(a){console.log(a),b("log",a)}function d(a){return console.error(a),b("error",a),a}function e(a){console.warn(a),b("warn",a)}function f(a){console.debug(a),b("debug",a)}var g=[],h=this._pushCount,i=this._consolePanel,j={log:c,error:d,warn:e,debug:f,setConsolePanel:a};return j}}),e.config(["$provide","$httpProvider",function(b,c){b.factory("pruHttpInterceptor",["$q","$$Logger","$$Analytics","$cookies","$$WCFSessionStorage",function(b,c,d,e,f){return{request:function(d){var g=b.defer();if(a.pru.wcf.currentDdo&&a.pru.wcf.currentDdo.page.serviceContext&&(d.url=/.*\/$/.test(a.pru.wcf.currentDdo.page.serviceContext)?a.pru.wcf.currentDdo.page.serviceContext+d.url:a.pru.wcf.currentDdo.page.serviceContext+"/"+d.url),/application\/json/.test(d.headers["Content-Type"])&&!d.headers["X-PruComponentID"])return b.reject("X-PruComponentId not found.."),c.error("WCF Error: X-PruComponentID not found.. Make sure to set X-PruComponentID in request header.  Request URL: "+d.url),g.promise;if(a.pru.wcf.currentDdo.page.pageInfo.ucdtoken&&(d.headers["X-Pru-CSRF"]=a.pru.wcf.currentDdo.page.pageInfo.ucdtoken),d.timeout=d.timeout?d.timeout:16e3,void 0===d.headers["X-PruRequestID"]){for(var h=(document.cookie.match(/JSESSIONID=[^;]+/)||[""])[0],i=h.indexOf("="),j=i>=0?h.substring(i+1):"",k="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",l=10;l>0;--l)j+=k[Math.round(Math.random()*(k.length-1))];d.headers["X-PruRequestID"]="wcf_"+j}var m="";f.isSupported()?sessionStorage.getItem("enviValue")&&(m=sessionStorage.getItem("enviValue")):e.enviValue&&(m=e.enviValue),m=m?m:"PROD",d.headers["X-PruEnvID"]=m;var n=0;return f.isSupported()?(sessionStorage.getItem("wcfRequestCounter")&&(n=sessionStorage.getItem("wcfRequestCounter")),sessionStorage.setItem("wcfRequestCounter",++n)):e.wcfRequestCounter&&(n=e.wcfRequestCounter,e.wcfRequestCounter=++n),d.headers["X-PruRequestCounter"]=n,d.requestTimestamp=(new Date).getTime(),c.log("Request Started for "+d.url+" at "),g.resolve(d),g.promise},requestError:function(a){return c.error("Error : "+JSON.stringify(a)),b.reject(a)},response:function(a){a.config=a.config||{},a.config.responseTimestamp=(new Date).getTime();var b=a.config.responseTimestamp-a.config.requestTimestamp;return c.log("The request took "+b/1e3+" seconds."),d.saveAnalyticInfo("ServiceResponseTime",{url:a.config.url,time:b,requestSentTime:a.config.requestTimestamp,responseReceivedTime:a.config.responseTimestamp}),a},responseError:function(e){e.config=e.config||{},e.config.responseTimestamp=(new Date).getTime();var f=e.config.responseTimestamp-e.config.requestTimestamp;return c.log("The request took "+f/1e3+" seconds."),d.saveAnalyticInfo("ServiceResponseTime",{url:e.config.url,time:f,requestSentTime:e.config.requestTimestamp,responseReceivedTime:e.config.responseTimestamp}),401!==e.status&&d.saveAnalyticInfo("ServiceFailure",{url:e.config.url,rejectionReason:JSON.stringify(e)}),401===e.status&&a.location.reload(),b.reject(e)}}}]),c.interceptors.push("pruHttpInterceptor")}]),e.service("$$DSM",["$$WCFLocalStorageService","$$WCFSessionStorage","$http","$q",function(c,e,f,g){var h=this;this.initialize=function(){a.pru.wcf.currentDdo="",e.isSupported()&&(sessionStorage.setItem("currentDdo",""),sessionStorage.getItem("localDataMap")&&(a.pru.wcf.localDataMap=JSON.parse(sessionStorage.getItem("localDataMap")),a.pru.wcf.keyNamesBag=JSON.parse(sessionStorage.getItem("keyNamesBag"))),(null===a.pru.wcf.localDataMap||"null"===a.pru.wcf.localDataMap)&&(a.pru.wcf.localDataMap=[],a.pru.wcf.keyNamesBag=[])),this.updatePage()},this.captureCampaign=function(b){if(b){var c=b.indexOf("?"),d=b.substring(c+1).split("&"),f={};if(f.componentName="Campaign Information",f.subCategory="Campaign",f.attributes=[],$.each(d,function(a,b){var c=b.split("=");f.attributes.push({key:c[0],value:c[1]})}),e.isSupported()){var g=JSON.parse(sessionStorage.getItem("currentDdo"));g.components.push(f),sessionStorage.setItem("currentDdo",JSON.stringify(g))}a.pru.wcf.currentDdo.components.push(f)}},this.captureComponent=function(b){var c=$('[data-ddo-component-id="'+b+'"]');if(c.length>1)return void(console&&console.error("WCF Error: Multiple objects found with "+b+" make sure only one object is present with this ID."));if(0===c.length)return void(console&&console.error("WCF Error: Component with ID "+b+" not found. Make sure component is defined on this page with provided ID."));for(var d={},f="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",g="wcf_",h=10;h>0;--h)g+=f[Math.round(Math.random()*(f.length-1))];if(d.wcfComponentID=g,c.attr("data-ddo-component-id")&&(d.componentID=c.attr("data-ddo-component-id")),c.attr("data-ddo-component-name")&&(d.componentName=c.attr("data-ddo-component-name")),c.attr("data-ddo-component-desc")&&(d.description=c.attr("data-ddo-component-desc")),c.attr("data-ddo-component-type")&&(d.componentType=c.attr("data-ddo-component-type")),c.attr("data-ddo-component-category")&&(d.category=c.attr("data-ddo-component-category")),c.attr("data-ddo-component-sub-category")&&(d.subCategory=c.attr("data-ddo-component-sub-category")),d.attributes=[],c.find("[data-ddo-component-attr]").each(function(){d.attributes.push({key:$(this).attr("data-ddo-component-attr"),value:$(this).val()})}),e.isSupported()){var i=JSON.parse(sessionStorage.getItem("currentDdo"));i.components.push(d),sessionStorage.setItem("currentDdo",JSON.stringify(i))}a.pru.wcf.currentDdo.components.push(d),this.capturePageError()},this.captureProduct=function(b){var c=$('[data-ddo-component-id="'+b+'"]');if(c.length>1)return void(console&&console.error("WCF Error: Multiple objects found with "+b+" make sure only one object is present with this ID."));if(0===c.length)return void(console&&console.error("WCF Error: Product with ID "+b+" not found. Make sure product is defined on this page with provided ID."));var d={};if(c.attr("data-ddo-product-id")&&(d.productID=c.attr("data-ddo-product-id")),c.attr("data-ddo-product-name")&&(d.productName=c.attr("data-ddo-product-name")),c.attr("data-ddo-product-desc")&&(d.description=c.attr("data-ddo-product-desc")),c.attr("data-ddo-product-type")&&(d.productType=c.attr("data-ddo-product-type")),c.attr("data-ddo-product-category")&&(d.category=c.attr("data-ddo-product-category")),c.attr("data-ddo-product-sub-category")&&(d.subCategory=c.attr("data-ddo-product-sub-category")),d.attributes=[],$("#"+b).find("[data-ddo-product-attr]").each(function(){d.attributes.push({key:$(this).attr("data-ddo-product-attr"),value:$(this).val()})}),e.isSupported()){var f=JSON.parse(sessionStorage.getItem("currentDdo"));f.products.push(d),sessionStorage.setItem("currentDdo",JSON.stringify(f))}a.pru.wcf.currentDdo.products.push(d),this.capturePageError()},this.captureClickEvent=function(c){var d=c,f={eventInfo:{}};if(b.forEach(d.currentTarget.attributes,function(a){if(0===a.name.indexOf("data-ddo-")){var b=a.name.split("-").splice(-1).pop();"location"===b?(f.attributes=[],f.attributes.push({key:b,value:a.value})):f.eventInfo[b]=a.value}}),e.isSupported()){var g=JSON.parse(sessionStorage.getItem("currentDdo"));g.events.push(f),sessionStorage.setItem("currentDdo",JSON.stringify(g))}a.pru.wcf.currentDdo.events.push(f),this.capturePageError(),console.log(f)},this.captureEvent=function(b){var c=$('[data-ddo-event-id="'+b+'"]');if(c.length>1)return void(console&&console.error("WCF Error: Multiple links found with "+b+" make sure only one link is present with this ID."));if(0===c.length)return void(console&&console.error("WCF Error: Event with ID "+b+" not found. Make sure event is defined on this page with provided ID."));var d={eventInfo:{}};if(d.eventID=b,c.attr("data-ddo-event-info-name")&&(d.eventInfo.eventName=c.attr("data-ddo-event-info-name")),c.attr("data-ddo-event-info-action")&&(d.eventInfo.eventAction=c.attr("data-ddo-event-info-action")),c.attr("data-ddo-event-info-points")&&(d.eventInfo.eventPoints=c.attr("data-ddo-event-info-points")),c.attr("data-ddo-event-info-type")&&(d.eventInfo.eventType=c.attr("data-ddo-event-info-type")),c.attr("data-ddo-event-info-effect")&&(d.eventInfo.eventEffect=c.attr("data-ddo-event-info-effect")),c.attr("data-ddo-event-info-location")){var f=c.attr("data-ddo-event-info-location");d.attributes=[],d.attributes.push({key:"location",value:f})}if(e.isSupported()){var g=JSON.parse(sessionStorage.getItem("currentDdo"));g.events.push(d),sessionStorage.setItem("currentDdo",JSON.stringify(g))}a.pru.wcf.currentDdo.events.push(d),this.capturePageError()},this.captureVideo=function(b,c){var d={};if(d.componentName=b,d.attributes=[],d.attributes.push({key:"action",value:c}),e.isSupported()){var f=JSON.parse(sessionStorage.getItem("currentDdo"));f.components.push(d),sessionStorage.setItem("currentDdo",JSON.stringify(f))}a.pru.wcf.currentDdo.components.push(d),this.capturePageError()},this.updatePage=function(){var b="";if(e.isSupported())sessionStorage.getItem("enviValue")&&(b=sessionStorage.getItem("enviValue"));else{var c=(document.cookie.match(/enviValue=[^;]+/)||[""])[0],d=c.indexOf("=");b=d>=0?c.substring(d+1):""}var f=document.getElementById("ddo.serviceEnvironment")?document.getElementById("ddo.serviceEnvironment").innerHTML:"",g=document.getElementById("ddo.page.serviceContext")?document.getElementById("ddo.page.serviceContext").innerHTML:"",h=document.getElementById("ddo.page.portalRegion")?document.getElementById("ddo.page.portalRegion").innerHTML:"",i=document.getElementById("ddo.page.stateManagerServiceURI")?document.getElementById("ddo.page.stateManagerServiceURI").innerHTML:"",j=document.getElementById("ddo.page.pageInfo.ucdtoken")?document.getElementById("ddo.page.pageInfo.ucdtoken").innerHTML:"",k=document.getElementById("ddo.page.pageInfo.sysEnv")?document.getElementById("ddo.page.pageInfo.sysEnv").innerHTML:"",l=document.getElementById("ddo.site")?document.getElementById("ddo.site").innerHTML:"",m=document.getElementById("ddo.page.pageInfo.pageId")?document.getElementById("ddo.page.pageInfo.pageId").innerHTML:"",n=document.getElementById("ddo.page.pageInfo.pageName")?document.getElementById("ddo.page.pageInfo.pageName").innerHTML:"",o=document.getElementById("ddo.page.category.pageType")?document.getElementById("ddo.page.category.pageType").innerHTML:"",p=document.getElementById("ddo.page.pageInfo.geoRegion")?document.getElementById("ddo.page.pageInfo.geoRegion").innerHTML:"",q=document.getElementById("ddo.page.pageInfo.language")?document.getElementById("ddo.page.pageInfo.language").innerHTML:"",r=document.getElementById("ddo.page.pageInfo.vanityURL")?document.getElementById("ddo.page.pageInfo.vanityURL").innerHTML:"",s=document.getElementById("ddo.page.marketingProfile.siteId")?document.getElementById("ddo.page.marketingProfile.siteId").innerHTML:"",t=document.getElementById("ddo.page.marketingProfile.campaignId")?document.getElementById("ddo.page.marketingProfile.campaignId").innerHTML:"",u=document.getElementById("ddo.page.marketingProfile.customerGUID")?document.getElementById("ddo.page.marketingProfile.customerGUID").innerHTML:"",v=document.getElementById("ddo.page.marketingProfile.clientID")?document.getElementById("ddo.page.marketingProfile.clientID").innerHTML:"",w=document.getElementById("ddo.page.marketingProfile.eventType")?document.getElementById("ddo.page.marketingProfile.eventType").innerHTML:"",x=document.getElementById("ddo.user.profile.profileInfo.legacyId")?document.getElementById("ddo.user.profile.profileInfo.legacyId").innerHTML:"",y=document.getElementById("ddo.user.profile.profileInfo.profileId")?document.getElementById("ddo.user.profile.profileInfo.profileId").innerHTML:"",z=document.getElementById("ddo.user.profile.profileInfo.sessionId")?document.getElementById("ddo.user.profile.profileInfo.sessionId").innerHTML:"",A=document.getElementById("ddo.user.profile.profileInfo.ssoId")?document.getElementById("ddo.user.profile.profileInfo.ssoId").innerHTML:"",B=document.getElementById("ddo.user.profile.profileInfo.legacyssoId")?document.getElementById("ddo.user.profile.profileInfo.legacyssoId").innerHTML:"",C=document.getElementById("ddo.user.profile.profileInfo.impersonateId")?document.getElementById("ddo.user.profile.profileInfo.impersonateId").innerHTML:"",D=document.getElementById("ddo.user.profile.profileInfo.userRole")?document.getElementById("ddo.user.profile.profileInfo.userRole").innerHTML:"",E=document.getElementById("ddo.user.profile.profileInfo.userType")?document.getElementById("ddo.user.profile.profileInfo.userType").innerHTML:"",F={environment:b,serviceEnvironment:f,site:l,pageInstanceId:m,page:{pageInfo:{pageId:m,ucdtoken:j,pageName:n,sysEnv:k,geoRegion:p,language:q,vanityURL:r,referringURL:document.referrer},marketingProfile:{siteId:s,campaignId:t,customerGUID:u,clientID:v,eventType:w},category:{pageType:o},products:[],serviceContext:g,portalRegion:h,stateManagerServiceURI:i},user:{profile:{profileInfo:{legacyId:x,profileId:y,sessionId:z,ssoId:A,legacyssoId:B,userRole:D,userType:E,impersonateId:C}}},components:[],events:[],products:[]};a.pru.wcf.currentDdo=F,F.page.attributes=[],$("[data-ddo-page-attr]").each(function(){F.page.attributes.push({key:$(this).attr("data-ddo-page-attr"),value:$(this).val()})}),e.isSupported()&&sessionStorage.setItem("currentDdo",JSON.stringify(F)),a.pru.wcf.currentDdo=F,this.captureGlobalProduct(),this.captureCampaign(document.URL)},this.captureGlobalProduct=function(){for(var b=$("[data-ddo-page-product-id]"),c=0;c<b.length;c++){var d=$(b[c]);if(d){var f={};d.attr("data-ddo-page-product-id")&&(f.productID=d.attr("data-ddo-page-product-id")),d.attr("data-ddo-page-product-name")&&(f.productName=d.attr("data-ddo-page-product-name")),d.attr("data-ddo-page-product-description")&&(f.description=d.attr("data-ddo-page-product-description")),d.attr("data-ddo-page-product-type")&&(f.productType=d.attr("data-ddo-page-product-type")),d.attr("data-ddo-page-product-category")&&(f.category=d.attr("data-ddo-page-product-category")),d.attr("data-ddo-page-product-sub-category")&&(f.subCategory=d.attr("data-ddo-page-product-sub-category")),f.attributes=[];for(var g=$(d).find("[data-ddo-page-product-attr]"),h=0;h<g.length;h++){var i=g[h];f.attributes.push({key:$(i).attr("data-ddo-page-product-attr"),value:$(i).val()})}if(e.isSupported()){var j=JSON.parse(sessionStorage.getItem("currentDdo"));j.page.products.push(f),sessionStorage.setItem("currentDdo",JSON.stringify(j))}a.pru.wcf.currentDdo.page.products.push(f)}}},this.capturePageError=function(){var b=document.getElementById("ddo.page.pageInfo.errorId")?document.getElementById("ddo.page.pageInfo.errorId").innerHTML:"",c=document.getElementById("ddo.page.pageInfo.errorDescription")?document.getElementById("ddo.page.pageInfo.errorDescription").innerHTML:"";if(e.isSupported()){var d=JSON.parse(sessionStorage.getItem("currentDdo"));b.length>0&&(d.page.pageInfo.errorId=b),c.length>0&&(d.page.pageInfo.errorDescription=c),sessionStorage.setItem("currentDdo",JSON.stringify(d))}b.length>0&&(a.pru.wcf.currentDdo.page.errorId=b),c.length>0&&(a.pru.wcf.currentDdo.page.errorDescription=c)},this.updateUser=function(){},this.capturePageEvents=function(){},this.saveAttribute=function(a,e){var f=g.defer();return e?c.isSensitiveStorageAvaialble()?c.postToServer(d.SET_ATTRIBUTES,a).then(function(d){b.forEach(a,function(a){c.setSensitiveData(a)}),f.resolve(d)},function(a){f.reject(a)}):f.reject("Sensitive Storage Not Avaialble!"):b.forEach(a,function(b){c.setInsensitiveData(b),f.resolve(a)}),f.promise},this.getAttribute=function(a,b){var d=g.defer();return c.getKeyData(a,b).then(function(a){d.resolve(a)},function(a){d.reject(a)}),d.promise},this.removeAttribute=function(b){var d=g.defer();return c.removeKeyData(b).then(function(b){e.isSupported()&&(sessionStorage.setItem("localDataMap",JSON.stringify(a.pru.wcf.localDataMap)),sessionStorage.setItem("keyNamesBag",JSON.stringify(a.pru.wcf.keyNamesBag))),d.resolve(b)},function(a){d.reject(a)}),d.promise},this.removeAllAttributes=function(b){var d=g.defer();return c.clearAll(b).then(function(b){e.isSupported()&&(sessionStorage.setItem("localDataMap",JSON.stringify(a.pru.wcf.localDataMap)),sessionStorage.setItem("keyNamesBag",JSON.stringify(a.pru.wcf.keyNamesBag))),d.resolve(b)},function(a){d.reject(a)}),d.promise},this.removeBatchAttributes=function(a){h.removeAllAttributes(a)},this.sessionTimeout=function(a){$.setSessionTimeout(a)}}]),e.service("$$WCFLocalStorageService",["$http","$q","$$WCFSessionStorage",function(e,f,g){var h=this;this.setSensitiveData=function(a){this.setInsensitiveData(a,c.SENSITIVE)},this.setInsensitiveData=function(b,d){var e=[];switch(this.keyTypeInBag(b.key)){case c.NONE:d?this.addKeyToBag(b.key,d):(a.pru.wcf.localDataMap.push({key:b.key,value:b.value}),this.addKeyToBag(b.key,c.INSENSITIVE));break;case c.INSENSITIVE:for(var f=!1,h=0;h<a.pru.wcf.localDataMap.length;h++){var i=a.pru.wcf.localDataMap[h];i.key===b.key&&(i.value=b.value,f=!0)}f||a.pru.wcf.localDataMap.push({key:b.key,value:b.value});break;default:e.push(b.key)}return e.length>0&&console.error("WCF Error - SessionStateManager - Keys already present in Sensitive Storage Area: "+JSON.stringify(e)),g.isSupported()&&(sessionStorage.setItem("localDataMap",JSON.stringify(a.pru.wcf.localDataMap)),sessionStorage.setItem("keyNamesBag",JSON.stringify(a.pru.wcf.keyNamesBag))),e},this.getKeyData=function(a,c){var e=f.defer(),g=[];if(h.allInSensitiveKeys(a,c)){for(var i=0;i<a.length;i++){var j=a[i].key,k=h.getInsensitiveData(j);void 0!==k&&g.push({key:j,value:h.getInsensitiveData(j)})}e.resolve(g)}else h.isSensitiveStorageAvaialble()&&this.postToServer(d.GET_ATTRIBUTES,a).then(function(c){b.forEach(c.data,function(a){g.push({key:a.key,value:a.value})}),b.forEach(a,function(a){var b=a.key,c=h.getInsensitiveData(b);c&&g.push({key:b,value:c})}),e.resolve(g)},function(a){e.reject(a)});return e.promise},this.getInsensitiveData=function(b){for(var c=0;c<a.pru.wcf.localDataMap.length;c++){var d=a.pru.wcf.localDataMap[c];if(b===d.key)return d.value}return void 0},this.removeKeyData=function(c){var e=f.defer(),g=function(a){b.forEach(a,function(a){h.removeInsensitiveKey(a.key)})},i=function(a){b.forEach(a,function(a){h.removeKeyFromBag(a.key)})};return h.allInSensitiveKeys(c)?(g(c),e.resolve(a.pru.wcf.localDataMap)):h.isSensitiveStorageAvaialble()?this.postToServer(d.REMOVE_ATTRIBUTES,c).then(function(a){g(c),i(c),e.resolve(a)},function(a){g(c),e.reject(a)}):(g(c),e.reject("Sensitive Data not removed: Sensitive Storage not avaialble")),e.promise},this.removeInsensitiveKey=function(b){for(var c=a.pru.wcf.localDataMap.length-1;c>-1;c--){var d=a.pru.wcf.localDataMap[c];if(b===d.key){a.pru.wcf.localDataMap.splice(c,1),this.removeKeyFromBag(b);break}}},this.removeAllInsensitiveData=function(){return a.pru.wcf.localDataMap=[],!1},this.removeAllInsensitiveKeys=function(){this.removeAllInsensitiveData(),this.removeAllKeysFromBag(c.INSENSITIVE)},this.allInSensitiveBatch=function(b){for(var d=!0,e=new RegExp("^"+b.substring(0,b.length-1),"i"),f=a.pru.wcf.keyNamesBag,g=0;g<f.length;g++)e.test(f[g].key)&&this.keyTypeInBag(f[g].key)===c.SENSITIVE&&(d=!1);return d},this.removeAllInsensitiveBatch=function(b){for(var d=new RegExp("^"+b.substring(0,b.length-1),"i"),e=a.pru.wcf.localDataMap.length-1;e>-1;e--){var f=a.pru.wcf.localDataMap[e];d.test(f.key)&&a.pru.wcf.localDataMap.splice(e,1)}for(var g=a.pru.wcf.keyNamesBag.length-1;g>-1;g--){var h=a.pru.wcf.keyNamesBag[g];d.test(h.key)&&h.value===c.INSENSITIVE&&a.pru.wcf.keyNamesBag.splice(g,1)}},this.removeSensitiveBatchKeys=function(b){for(var d=new RegExp("^"+b.substring(0,b.length-1),"i"),e=a.pru.wcf.keyNamesBag.length-1;e>-1;e--){var f=a.pru.wcf.keyNamesBag[e];d.test(f.key)&&f.value===c.SENSITIVE&&a.pru.wcf.keyNamesBag.splice(e,1)}},this.clearAll=function(a){var b=f.defer();return a?h.allInSensitiveBatch(a)?(h.removeAllInsensitiveBatch(a),b.resolve()):h.isSensitiveStorageAvaialble()?this.postToServer(d.REMOVE_ATTRIBUTES,[{key:a}]).then(function(){h.removeSensitiveBatchKeys(a),h.removeAllInsensitiveBatch(a),b.resolve()},function(c){h.removeAllInsensitiveBatch(a),b.reject(c)}):(h.removeAllInsensitiveBatch(a),b.reject("Sensitive Data not removed: Sensitive Storage not avaialble")):h.allInSensitiveKeys()?(h.removeAllInsensitiveKeys(),b.resolve()):h.isSensitiveStorageAvaialble()?this.postToServer(d.REMOVE_ALL_ATTRIBUTES,"[{}]").then(function(a){h.clearAllSensitiveKeys(),h.removeAllInsensitiveKeys(),b.resolve(a)},function(a){h.removeAllInsensitiveKeys(),b.reject(a)}):(h.removeAllInsensitiveKeys(),b.reject("Sensitive Data not removed: Sensitive Storage not avaialble")),b.promise},this.addKeyToBag=function(b,c){a.pru.wcf.keyNamesBag.push({key:b,value:c})},this.removeKeyFromBag=function(b){for(var c=a.pru.wcf.keyNamesBag.length-1;c>-1;c--){var d=a.pru.wcf.keyNamesBag[c];if(b===d.key)return a.pru.wcf.keyNamesBag.splice(c,1),!0}return!1},this.removeAllKeysFromBag=function(b){for(var c=a.pru.wcf.keyNamesBag.length-1;c>-1;c--){var d=a.pru.wcf.keyNamesBag[c];b===d.value&&a.pru.wcf.keyNamesBag.splice(c,1)}},this.keyTypeInBag=function(b){for(var d=0;d<a.pru.wcf.keyNamesBag.length;d++)if(b===a.pru.wcf.keyNamesBag[d].key)return a.pru.wcf.keyNamesBag[d].value;return c.NONE},this.clearAllSensitiveKeys=function(){this.removeAllKeysFromBag(c.SENSITIVE)},this.allInSensitiveKeys=function(b,d){if(d)return!1;for(var e=b?b:a.pru.wcf.keyNamesBag,f=0;f<e.length;f++){var g=this.keyTypeInBag(e[f].key);if(g===c.SENSITIVE)return!1;if(g===c.NONE&&h.isSensitiveStorageAvaialble())return"undefined"==typeof d||d?!1:!0}return!0},this.isSensitiveStorageAvaialble=function(){return a.pru.wcf.currentDdo.page.stateManagerServiceURI?!0:!1},this.postToServer=function(b,c){var d=f.defer(),g=a.pru.wcf.currentDdo.page.stateManagerServiceURI?a.pru.wcf.currentDdo.page.stateManagerServiceURI:"";return c='{ "data" : '+JSON.stringify(c)+"}",g?(/.*\/$/.test(g)?g+=b:g=g+"/"+b,e({method:"POST",url:g,data:c,headers:{"X-PruComponentID":"SessionStateManagerV1.00"}}).then(function(a){"object"==typeof a.data?d.resolve(a.data):d.reject(a.data)},function(a){d.reject(a)}),console.log("Post done ...")):(console.error("WCF Error: SessionStateManager - Framework to capture sensitive data is not available in your application, or a wrong URL is provided. Check the value of span with id ddo.page.stateManagerServiceURI"),d.reject("WCF Error: SessionStateManager - Framework to capture sensitive data is not available in your application, or a wrong URL is provided. Check the value of span with id ddo.page.stateManagerServiceURI")),d.promise}}]),e.directive("captureComponent",["$$DSM",function(a){return{restrict:"A",link:function(b,c,d){c.bind("click",function(){a.captureComponent(d.captureComponent)})}}}]),e.directive("captureEvent",["$$DSM",function(a){return{restrict:"A",link:function(b,c,d){c.bind("click",function(){a.captureEvent(d.captureEvent),b&&console&&console.log("WCF - $Scope")})}}}]),e.directive("captureVideo",["$$DSM",function(a){return{restrict:"A",link:function(b,c,d){c.bind("click",function(){a.captureVideo(d.id,"play")}),c.bind("onpause",function(){a.captureVideo(d.id,"onpause")})}}}]),e.service("$$WCFSessionStorage",function(){this.isSupported=function(){try{if(sessionStorage)return sessionStorage.setItem("dummy","dummy"),!0}catch(a){return console.error("WCF - Session Storage Not Available in current Browser - Using fallback method: "+a.message),!1}return!1},this.clear=function(){sessionStorage.setItem("currentDdo","")}})}(window,window.angular),function(a){"use strict";a.setSessionTimeout=function(b){function c(a){document.cookie="prutimer="+a+";path=/"+r}function d(){document.cookie="prutimer=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/"+r}function e(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b)){var f=e.substring(b.length,e.length);return f?parseInt(f):""}}return""}function f(){!v&&n.keepAliveUrl&&(a.each(n.keepAliveUrl,function(b){a.ajax({type:n.ajaxType,url:n.keepAliveUrl[b],data:n.ajaxData})}),v=!0,setTimeout(function(){v=!1},n.keepAliveInterval))}function g(b,c){c=c?c:n.warnAfter,clearTimeout(k),clearTimeout(j),clearInterval(l),n.countdownBar&&(a(".countdown-bar").css("width","100%"),a(".countdown-holder").text("")),"function"==typeof n.onStart&&n.onStart(n),!b&&n.keepAlive&&f(),k=setTimeout(function(){if("function"!=typeof n.onWarn){var b=e("prutimer");if(b){var d=(new Date).getTime();d>=b?(a("#session-timeout-dialog").modal("show"),h(c)):g(!0,b-d)}else window.location=n.logoutUrl}else n.onWarn(n)},c)}function h(b){clearTimeout(j),a("#session-timeout-dialog").hasClass("in")&&(n.countdownMessage||n.countdownBar)&&i("dialog",b);var c=0>=b?b+n.redirAfter-n.warnAfter:n.redirAfter-n.warnAfter;j=setTimeout(function(){var b=e("prutimer");if(b){var c=(new Date).getTime();c>=b+n.redirAfter-n.warnAfter?"function"!=typeof n.onRedir?n.refreshOnTimeOut?(a("#session-timeout-dialog").modal("hide"),window.location.reload(!0)):(n.redirUrl=n.redirUrl?n.redirUrl:n.logoutUrl,d(),window.location=n.redirUrl):n.onRedir(n):(a("#session-timeout-dialog").modal("hide"),g(!0,b-c))}else window.location=n.logoutUrl},c)}function i(b,c){clearInterval(l),"dialog"===b?o.timeLeft=Math.floor(c&&0>=c?(c+n.redirAfter-n.warnAfter)/1e3:(n.redirAfter-n.warnAfter)/1e3):"session"===b&&(o.timeLeft=Math.floor(n.redirAfter/1e3));var d=a(".countdown-holder");l=setInterval(function(){n.countdownBar&&"dialog"===b?o.percentLeft=Math.floor(o.timeLeft/((n.redirAfter-n.warnAfter)/1e3)*100):n.countdownBar&&"session"===b&&(o.percentLeft=Math.floor(o.timeLeft/(n.redirAfter/1e3)*100));var c=o.timeLeft>=0?o.timeLeft:0;if(n.countdownSmart){var e=Math.floor(c/60),f=c%60,g=e>0?e+"m ":"";g+=f+"s",d.text(g)}else d.text(c+"s");n.countdownBar&&a(".countdown-bar").css("width",o.percentLeft+"%"),o.timeLeft=o.timeLeft-1},1e3)}var j,k,l,m={title:'Your Session is About to Expire<span class="sr-only"> in 2 minutes</span>!',message:"",logoutButton:"Logout",keepAliveButton:"Stay Connected",keepAliveUrl:"",ajaxType:"GET",ajaxData:"",refreshOnTimeOut:!1,redirUrl:"",logoutUrl:"/log-out",logoutFunction:"",warnAfter:48e4,redirAfter:54e4,warnOnly:!1,keepAliveInterval:5e3,keepAlive:!0,ignoreUserActivity:!0,onStart:!1,onWarn:!1,onRedir:!1,countdownMessage:!1,countdownBar:!0,countdownSmart:!0,hideModalOnAction:!1},n=m,o={},p=window.location.hostname.toLowerCase(),q="localhost"===p||"edgnydev1.prudential.com"===p,r=q?"":";domain=.prudential.com;path=/";if(b&&(n=a.extend(m,b)),!n.warnOnly&&n.warnAfter>=n.redirAfter)return console.error('Option "redirAfter" must be equal or greater than "warnAfter".'),!1;if("function"!=typeof n.onWarn){var s=n.countdownMessage?"<p>"+n.countdownMessage.replace(/{timer}/g,'<span class="countdown-holder"></span>')+"</p>":"",t=n.countdownBar?'<div class="progress"> \r\n                  <div class="progress-bar progress-bar-striped countdown-bar active" role="progressbar" style="min-width: 15px; width: 100%;"> \r\n                    <span class="countdown-holder"></span> \r\n                  </div> \r\n                </div>':"";a("body").append('<div class="modal bs-example-modal-md" id="session-timeout-dialog" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false"> \r\n              <div class="modal-dialog"> \r\n                <div class="modal-content"> \r\n                  <div class="modal-header"> \r\n                  <h4 class="modal-title inline-block" tabindex="0">'+n.title+'</h4> \r\n                  </div> \r\n                  <div class="modal-body"> \r\n                    <p>'+n.message+"</p> \r\n                    "+s+" \r\n                    "+t+' \r\n                  </div> \r\n                  <div class="modal-footer"> \r\n                    <button id="session-timeout-dialog-logout" type="button" class="btn btn-default">'+n.logoutButton+'</button> \r\n                    <button id="session-timeout-dialog-keepalive" type="button" class="btn btn-primary" data-dismiss="modal">'+n.keepAliveButton+"</button> \r\n                  </div> \r\n                </div> \r\n              </div> \r\n             </div>"),a("#session-timeout-dialog-logout").on("click",function(){n.logoutFunction?n.logoutFunction():(d(),window.location=n.logoutUrl)}),a("#session-timeout-dialog-keepalive").on("click",function(){var a=e("prutimer");a?f():window.location=n.logoutUrl}),a("#session-timeout-dialog").on("shown.bs.modal",function(){a("#session-timeout-dialog h4.modal-title").focus()}),a("#session-timeout-dialog-keepalive").on("keydown",function(b){9!==b.which||b.shiftKey||(b.preventDefault(),a("#session-timeout-dialog h4.modal-title").focus())}),a("#session-timeout-dialog h4.modal-title").on("keydown",function(b){9===b.which&&b.shiftKey&&(b.preventDefault(),a("#session-timeout-dialog-keepalive").focus())})}if(!n.ignoreUserActivity){var u=[-1,-1];a(document).on("keyup mouseup mousemove touchend touchmove",function(b){if("mousemove"===b.type){if(b.clientX===u[0]&&b.clientY===u[1])return;u[0]=b.clientX,u[1]=b.clientY}g(!1),a("#session-timeout-dialog").length>0&&a("#session-timeout-dialog").data("bs.modal")&&n.hideModalOnAction&&a("#session-timeout-dialog").data("bs.modal").isShown&&(a("#session-timeout-dialog").modal("hide"),a("body").removeClass("modal-open"),a("div.modal-backdrop").remove())})}var v=!1;!function(a){window.XMLHttpRequest.prototype.open=function(b,d,e,f,h){c((new Date).getTime()+n.warnAfter),g(!0),a.call(this,b,d,e,f,h)}}(window.XMLHttpRequest.prototype.open),c((new Date).getTime()+n.warnAfter),f(),g(!1)}}(window.jQuery);